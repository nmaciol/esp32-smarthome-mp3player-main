# Summary

The aim of this project is to develop an MP3 and TTS player that can be used for message and sound output in smart homes. The audio generated by text-to-speech is recorded and stored as an MP3 file on the SD card so that it can be played directly from there when called up again.

# Features:

- TTS (TextToSpeech): Google TTS free API (no registration needed)
- Playing MP3 audio are working offline, online connection needed for first tims use TTS and for long TTS Masseges
- MQTT for Triggering ESP actions
- FTP-Server use for one connection for upload of MP3-Files and setup of App.ini
- Queue for sequential playback of TTS and MP3 jobs and to avoid message overlap
- 

# Hardware

- ESP32-Audio-Kit ESP32-A1S 4 MB oder 8 MB for 15-17â‚¬ on Aliexpress.
- ![1763652821688|](images/README/1763652821688.png )

# Installation & Customizing

- Modify app.ini on the SD card
- Upload the project to VS Code
- Build firmware with PlatformIO and upload it to ESP32-A1S
- 

# Known issues

- Google TTS support short sentences only (Google limitation)
- The MQTT packet size is limited; messages and headers can be up to 256 bytes in size. If it to big then the ESP crashes and restarts
- The message queue was successfully tested using up to 10 KB of FreeHeep. There were about 60 messages.
- If the Internet connection is interrupted during a call to TTS services, the ESP crashes and restarts.
- The directory containing the cached MP3 files must not be too large, so please be careful. I have tested up to 1000 files.

## Jumper

- Jumper positions are: OFF,ON,ON,OFF,OFF

## SD-Card

- Format as FAT
- Copy the strucktur of direktory SD-Card to SD-Card and configuration App.ini file

## MQTT Command Topics:

| Topic            | Value | Responds                                      | Description               |
| :--------------- | :---- | --------------------------------------------- | ------------------------- |
| [host-name]/ping | .     | MP3 player responds with [host-name]/FreeHeap | Use this to get FreeHeap. |

## MP3/TTS Player Topics:

| Topic               | Topic example | value            | Description                              |
| :------------------ | ------------- | ---------------- | ---------------------------------------- |
| [host-name]/mp3     | gong-q/mp3    | /mp3/gong-a.mp3  |                                          |
| [host-name]/tts     | gong-q/tts    | Hallo Mp3-Player |                                          |
| [host-name]/ttm     | gong-q/ttm    | Hallo Mp3-Player | The audio file is cached as an MP3 file. |
| [host-name]/stop    | gong-q/stop   | .                |                                          |
| [host-name]/volume  | gong-q/volume | 0.8              | max. Value 1                             |
| [host-name]/reboot  | gong-q/reboot | .                |                                          |
| [host-name]/speed   | gong-q/speed  | .                | Applies only to TTS and new TTM files    |
| [mqtt-house]/mp3    | gong/mp3      | /mp3/gong-a.mp3  |                                          |
| [mqtt-house]/tts    | gong/tts      | Hallo            |                                          |
| [mqtt-house]/ttm    | gong/ttm      | Hallo            | The audio file is cached as an MP3 file. |
| [mqtt-house]/stop   | gong/stop     | .                |                                          |
| [mqtt-house]/volume | gong/volume   | 0.8              |                                          |

## Origin

[https://github.com/pschatzmann/arduino-audio-tools](https://)

